<!DOCTYPE html>
<!-- saved from url=(0083)https://reflectoring.io/consumer-driven-contracts-with-pact-feign-spring-data-rest/ -->
<html lang="en" class=" js "><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    

<!-- begin SEO -->









<title>Consumer-Driven Contracts with Pact, Feign and Spring Data REST - Reflectoring</title>




<meta name="description" content="When thinking about integration testing in a distributed system, you quickly come across the concept of consumer-driven contracts. This blog post gives a short introduction intothis concept and a concrete implementation example using the technologies Pact,Spring Boot, Feign and Spring Data REST.">




<meta name="author" content="tom">

<meta property="og:locale" content="en">
<meta property="og:site_name" content="Reflectoring">
<meta property="og:title" content="Consumer-Driven Contracts with Pact, Feign and Spring Data REST">


  <link rel="canonical" href="https://reflectoring.io/consumer-driven-contracts-with-pact-feign-spring-data-rest/">
  <meta property="og:url" content="https://reflectoring.io/consumer-driven-contracts-with-pact-feign-spring-data-rest/">



  <meta property="og:description" content="When thinking about integration testing in a distributed system, you quickly come across the concept of consumer-driven contracts. This blog post gives a short introduction intothis concept and a concrete implementation example using the technologies Pact,Spring Boot, Feign and Spring Data REST.">





  

  



  <meta property="og:image" content="https://reflectoring.io/assets/images/reflectoringLogo.png">



  <meta property="og:type" content="article">
  <meta property="article:published_time" content="2017-08-09T00:00:00+00:00">






  <script type="text/javascript" async="" src="./Consumer-Driven Contracts with Pact, Feign and Spring Data REST - Reflectoring_files/ga.js.download"></script><script type="application/ld+json">
    {
      "@context": "http://schema.org",
      "@type": "Organization",
      "url": "https://reflectoring.io",
      "logo": "https://reflectoring.io/assets/images/reflectoringLogo.png"
    }
  </script>



  <script type="application/ld+json">
    {
      "@context" : "http://schema.org",
      "@type" : "Person",
      "name" : "Reflectoring",
      "url" : "https://reflectoring.io",
      "sameAs" : null
    }
  </script>






<!-- end SEO -->


<link href="https://reflectoring.io/feed.xml" type="application/atom+xml" rel="alternate" title="Reflectoring Feed">

<link rel="icon" type="image/x-icon" href="https://reflectoring.io/assets/images/logo/favicon.ico">

<!-- http://t.co/dKP3o1e -->
<meta name="HandheldFriendly" content="True">
<meta name="MobileOptimized" content="320">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script>
  document.documentElement.className = document.documentElement.className.replace(/\bno-js\b/g, '') + ' js ';
</script>

<!-- For all browsers -->
<link rel="stylesheet" href="./Consumer-Driven Contracts with Pact, Feign and Spring Data REST - Reflectoring_files/main.css">

<!--[if lte IE 9]>
  <style>
    /* old IE unsupported flexbox fixes */
    .greedy-nav .site-title {
      padding-right: 3em;
    }
    .greedy-nav button {
      position: absolute;
      top: 0;
      right: 0;
      height: 100%;
    }
  </style>
<![endif]-->

<meta http-equiv="cleartype" content="on">

    <!-- start custom head snippets -->

<!-- end custom head snippets -->

  <script type="text/javascript" async="" src="./Consumer-Driven Contracts with Pact, Feign and Spring Data REST - Reflectoring_files/embed.js.download"></script><script async="" type="text/javascript" src="./Consumer-Driven Contracts with Pact, Feign and Spring Data REST - Reflectoring_files/count.js.download"></script><style id="fit-vids-style">.fluid-width-video-wrapper{width:100%;position:relative;padding:0;}.fluid-width-video-wrapper iframe,.fluid-width-video-wrapper object,.fluid-width-video-wrapper embed {position:absolute;top:0;left:0;width:100%;height:100%;}</style><link rel="preload" as="style" href="https://c.disquscdn.com/next/embed/styles/lounge.3999ac261b914f8b8b5e85df0ff3eaea.css"><link rel="preload" as="script" href="https://c.disquscdn.com/next/embed/common.bundle.5f8e47303ecf1055cd7c6905466d140a.js"><link rel="preload" as="script" href="https://c.disquscdn.com/next/embed/lounge.bundle.33067ddbd4792de0b384ceb588602715.js"><link rel="preload" as="script" href="https://disqus.com/next/config.js"><script src="./Consumer-Driven Contracts with Pact, Feign and Spring Data REST - Reflectoring_files/alfalfa.4a5fcca1fe50a757044dfd331b660625.js.download" async="" charset="UTF-8"></script></head>

  <body class="layout--single" style="margin-bottom: 220px;">

    <!--[if lt IE 9]>
<div class="notice--danger align-center" style="margin: 0;">You are using an <strong>outdated</strong> browser. Please <a href="http://browsehappy.com/">upgrade your browser</a> to improve your experience.</div>
<![endif]-->
    <div class="masthead">
  <div class="masthead__inner-wrap">
    <div class="masthead__menu">
      <nav id="site-nav" class="greedy-nav">
        <a class="site-title" href="https://reflectoring.io/">Reflectoring</a>
        <ul class="visible-links">
          
            
            <li class="masthead__menu-item"><a href="https://reflectoring.io/about/">
              
              About Reflectoring</a></li>
          
            
            <li class="masthead__menu-item"><a href="https://reflectoring.io/search/">
              
                <i class="fa fa-fw fa-search" aria-hidden="true"></i>
              
              Search</a></li>
          
            
            <li class="masthead__menu-item"><a href="https://github.com/reflectoring/reflectoring.github.io">
              
                <i class="fa fa-fw fa-github" aria-hidden="true"></i>
              
              GitHub</a></li>
          
            
            <li class="masthead__menu-item"><a href="https://reflectoring.io/feed.xml">
              
                <i class="fa fa-fw fa-rss-square" aria-hidden="true"></i>
              
              Feed</a></li>
          
        </ul>
        <button count="0" class="hidden"><div class="navicon"></div></button>
        <ul class="hidden-links hidden"></ul>
      </nav>
    </div>
  </div>
</div>


    

<div id="main" role="main">
  
  <div class="sidebar sticky">
  

<div itemscope="" itemtype="http://schema.org/Person">

  
    <div class="author__avatar">
      
        <img src="./Consumer-Driven Contracts with Pact, Feign and Spring Data REST - Reflectoring_files/tom.png" class="author__avatar" alt="Tom Hombergs" itemprop="image">
      
    </div>
  

  <div class="author__content">
    <h3 class="author__name" itemprop="name">Tom Hombergs</h3>
    
  </div>

  <div class="author__urls-wrapper">
    <button class="btn btn--inverse">Follow</button>
    <ul class="author__urls social-icons">
      
        <li itemprop="homeLocation" itemscope="" itemtype="http://schema.org/Place">
          <i class="fa fa-fw fa-map-marker" aria-hidden="true"></i> <span itemprop="name">Germany</span>
        </li>
      

      

      
        <li>
          <a href="mailto:tom.hombergs@gmail.com">
            <meta itemprop="email" content="tom.hombergs@gmail.com">
            <i class="fa fa-fw fa-envelope-square" aria-hidden="true"></i> Email
          </a>
        </li>
      

      

      

      

      

      

      

      

      

      

      
        <li>
          <a href="https://github.com/thombergs" itemprop="sameAs">
            <i class="fa fa-fw fa-github" aria-hidden="true"></i> GitHub
          </a>
        </li>
      

      

      
        <li>
          <a href="https://www.stackoverflow.com/users/2375843/tom" itemprop="sameAs">
            <i class="fa fa-fw fa-stack-overflow" aria-hidden="true"></i> Stackoverflow
          </a>
        </li>
      

      

      

      

      

      

      

      

      

      

      

      

      <!--
  <li>
    <a href="http://link-to-whatever-social-network.com/user/" itemprop="sameAs">
      <i class="fa fa-fw" aria-hidden="true"></i> Custom Social Profile Link
    </a>
  </li>
-->
    </ul>
  </div>
</div>

  
  </div>



  <article class="page" itemscope="" itemtype="http://schema.org/CreativeWork">
    <meta itemprop="headline" content="Consumer-Driven Contracts with Pact, Feign and Spring Data REST">
    <meta itemprop="description" content="When thinking about integration testing in a distributed system, you quickly come across the concept of consumer-driven contracts. This blog post gives a short introduction intothis concept and a concrete implementation example using the technologies Pact,Spring Boot, Feign and Spring Data REST.">
    <meta itemprop="datePublished" content="August 09, 2017">
    

    <div class="page__inner-wrap">
      
        <header>
          

          <h1 class="page__title" itemprop="headline">Consumer-Driven Contracts with Pact, Feign and Spring Data REST
</h1>
          
            <p class="page__meta"><i class="fa fa-clock-o" aria-hidden="true"></i> 




  8 minute read
</p>
          
        </header>
      

      <section class="page__content" itemprop="text">
        <p>When thinking about integration testing in a distributed system, you quickly come across the 
concept of consumer-driven contracts. This blog post gives a short introduction into
this concept and a concrete implementation example using the technologies <a href="https://docs.pact.io/">Pact</a>,
<a href="https://projects.spring.io/spring-boot/">Spring Boot</a>, <a href="https://github.com/OpenFeign/feign">Feign</a> 
and <a href="https://projects.spring.io/spring-data-rest/">Spring Data REST</a>.</p>

<div class="notice--success">
  <img src="./Consumer-Driven Contracts with Pact, Feign and Spring Data REST - Reflectoring_files/github-mark-48px.png" style="float:right" alt="View on Github">
  <h4>Code Example</h4>
  This article is accompanied by working example code for the <a href="https://github.com/thombergs/code-examples/tree/master/pact/pact-feign-consumer">consumer</a> 
  and the <a href="https://github.com/thombergs/code-examples/tree/master/pact/pact-spring-data-rest-provider">provider</a>.
</div>

<div class="notice--warning">
    <h4>Other Articles in the Series about Consumer-Driven Contracts</h4>
    
      <ul>
       
         
         
          <li><a href="https://reflectoring.io/7-reasons-for-consumer-driven-contracts/">7 Reasons to Choose Consumer-Driven Contract Tests Over End-to-End Tests</a></li>
         
       
         
         
          <li><a href="https://reflectoring.io/consumer-driven-contracts-with-angular-and-pact/">Creating a Consumer-Driven Contract with Angular and Pact</a></li>
         
       
         
         
          <li><a href="https://reflectoring.io/consumer-driven-contract-feign-pact/">Creating a Consumer-Driven Contract with Feign and Pact</a></li>
         
       
         
         
          <li><a href="https://reflectoring.io/consumer-driven-contract-provider-pact-spring/">Testing a Spring Boot REST API against a Consumer-Driven Contract with Pact</a></li>
         
       
         
         
          <li><a href="https://reflectoring.io/consumer-driven-contract-provider-spring-cloud-contract/">Testing a Spring Boot REST API Provider against Contract with Spring Cloud Contract</a></li>
         
       
         
         
          <li><a href="https://reflectoring.io/consumer-driven-contract-consumer-spring-cloud-contract/">Testing a Spring Boot REST API Consumer against Contract with Spring Cloud Contract</a></li>
         
       
      </ul>
    
  </div>

<h2 id="integration-test-hell">Integration Test Hell</h2>

<p>Each service in a distributed system potentially communicates with a set of other services within 
or even beyond that system. This communication hopefully takes place through well-defined
APIs that are stable between releases.</p>

<p>To validate that the communication between a consumer and a provider of an API still works as
intended after some code changes were made, the common reflex is to setup integration tests. So, for each
combination of an API provider and consumer, we write one or more integration tests. For the integration
tests to run automatically, we then have to deploy the provider service to an integration 
environment and then run the consumer application against its API. As if that is not challenging
enough, the provider service may have some runtime dependencies that also have to be deployed,
which have their own dependencies and soon you have the entire distributed system deployed
for your integration tests.</p>

<p>This may be fine if your release schedule only contains a couple releases per year. But if you
want to release each service often and independently (i.e. you want to
practice continuous delivery) this integration testing strategy does not suffice.</p>

<p>To enable continuous delivery we have to decouple the integration tests from an actual 
runtime test environment. This is where consumer-driven contracts come into play.</p>

<h2 id="consumer-driven-contracts">Consumer-Driven Contracts</h2>

<p>The idea behind consumer-driven contracts is to define a contract between each consumer/provider
pair and then test the consumer and provider against that contract independently to verify that
they abide by the contract. This way each “integration test” can run separately and without
a full-blown runtime test environment.</p>

<p>The contract lies in the responsibility of the consumer, hence the name “consumer-driven”. 
For example, the consumer defines a set of requests with expected responses within a contract. This way,
the provider knows exactly which API calls are actually used out there in the wild and unused APIs
can safely be removed from the code base.</p>

<p>Of course, the contract is created by the consumer in 
agreement with the provider so that it cannot define API calls the provider doesn’t want to support.</p>

<figure>
  
<img src="./Consumer-Driven Contracts with Pact, Feign and Spring Data REST - Reflectoring_files/consumer-driven-contracts.png" alt="Consumer-Driven-Contracts">

  <figcaption>The consumer creates and maintains a contract. Both the consumer and provider verify against that contract
  with every change in their code base.</figcaption>
</figure>

<p>The process of consumer-driven contracts looks like this:</p>

<ol>
  <li>The API consumer creates and maintains a contract (in agreement with the provider).</li>
  <li>The API consumer verifies that it successfully runs against the contract.</li>
  <li>The API consumer publishes the contract.</li>
  <li>The API provider verifies that it successfully runs against the contract.</li>
</ol>

<p>In the following sections, I will show how to implement these steps with 
<a href="https://docs.pact.io/">Pact</a>, <a href="https://projects.spring.io/spring-boot/">Spring Boot</a>, 
an API consumer implemented with <a href="https://github.com/OpenFeign/feign">Feign</a> and an API provider 
implemented with <a href="https://projects.spring.io/spring-data-rest/">Spring Data REST</a>.</p>

<h2 id="pact">Pact</h2>

<p>Pact is a collection of frameworks that support the idea of consumer-driven contracts. 
The core of Pact it is a <a href="https://github.com/pact-foundation/pact-specification">specification</a>
that provides guidelines for implementations in different languages. Implementations are
available for a number of different languages and frameworks. In this blog post we will
focus on the Pact integrations with JUnit 4 (<a href="https://github.com/DiUS/pact-jvm/tree/master/pact-jvm-consumer-junit">pact-jvm-consumer-junit_2.11</a>
and <a href="https://github.com/DiUS/pact-jvm/tree/master/pact-jvm-provider-junit">pact-jvm-provider-junit_2.11</a>).</p>

<p>Aside from Java, it is noteworthy that Pact also <a href="https://github.com/pact-foundation/pact-js">integrates with JavaScript</a>. 
So, for example, 
when developing a distributed system with Java backend services and Angular frontends, Pact supports contract testing between
your frontends and backends as well as between backend services who call each other.</p>

<p>Obviously, instead of calling it a “contract”, Pact uses the word “pact” to define an agreement between
an API consumer and provider. “Pact” and “contract” are used synonymously from here on.</p>

<h2 id="creating-and-verifying-a-pact-on-the-consumer-side">Creating and Verifying a pact on the Consumer Side</h2>

<p>Let’s create an API client with Feign, create a pact and verify the client against that pact.</p>

<h3 id="the-feign-client">The Feign Client</h3>

<p>Our API consumer is a Feign client that reads a collection of addresses from 
a REST API provided by the customer service. The following code snippet is the whole client.
More details about how to create a Feign client against a Spring Data REST API can be read in 
<a href="https://reflectoring.io/accessing-spring-data-rest-with-feign/">this blog post</a>.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@FeignClient</span><span class="o">(</span><span class="n">value</span> <span class="o">=</span> <span class="s">"addresses"</span><span class="o">,</span> <span class="n">path</span> <span class="o">=</span> <span class="s">"/addresses"</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">interface</span> <span class="nc">AddressClient</span> <span class="o">{</span>

  <span class="nd">@RequestMapping</span><span class="o">(</span><span class="n">method</span> <span class="o">=</span> <span class="n">RequestMethod</span><span class="o">.</span><span class="na">GET</span><span class="o">,</span> <span class="n">path</span> <span class="o">=</span> <span class="s">"/"</span><span class="o">)</span>
  <span class="n">Resources</span><span class="o">&lt;</span><span class="n">Address</span><span class="o">&gt;</span> <span class="nf">getAddresses</span><span class="o">();</span>

<span class="o">}</span>
</code></pre></div></div>

<h3 id="the-pact-verifying-unit-test">The Pact-Verifying Unit Test</h3>

<p>Now, we want to create a pact using this client and validate that the client works correctly against this pact.
This is the Unit test that does just that:</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@RunWith</span><span class="o">(</span><span class="n">SpringRunner</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
<span class="nd">@SpringBootTest</span><span class="o">(</span><span class="n">properties</span> <span class="o">=</span> <span class="o">{</span>
        <span class="c1">// overriding provider address</span>
        <span class="s">"addresses.ribbon.listOfServers: localhost:8888"</span>
<span class="o">})</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">ConsumerPactVerificationTest</span> <span class="o">{</span>

  <span class="nd">@Rule</span>
  <span class="kd">public</span> <span class="n">PactProviderRuleMk2</span> <span class="n">stubProvider</span> <span class="o">=</span> 
    <span class="k">new</span> <span class="nf">PactProviderRuleMk2</span><span class="o">(</span><span class="s">"customerServiceProvider"</span><span class="o">,</span> <span class="s">"localhost"</span><span class="o">,</span> <span class="mi">8888</span><span class="o">,</span> <span class="k">this</span><span class="o">);</span>

  <span class="nd">@Autowired</span>
  <span class="kd">private</span> <span class="n">AddressClient</span> <span class="n">addressClient</span><span class="o">;</span>

  <span class="nd">@Pact</span><span class="o">(</span><span class="n">state</span> <span class="o">=</span> <span class="s">"a collection of 2 addresses"</span><span class="o">,</span> 
    <span class="n">provider</span> <span class="o">=</span> <span class="s">"customerServiceProvider"</span><span class="o">,</span> 
    <span class="n">consumer</span> <span class="o">=</span> <span class="s">"addressClient"</span><span class="o">)</span>
  <span class="kd">public</span> <span class="n">RequestResponsePact</span> <span class="nf">createAddressCollectionResourcePact</span><span class="o">(</span><span class="n">PactDslWithProvider</span> <span class="n">builder</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">return</span> <span class="n">builder</span>
            <span class="o">.</span><span class="na">given</span><span class="o">(</span><span class="s">"a collection of 2 addresses"</span><span class="o">)</span>
            <span class="o">.</span><span class="na">uponReceiving</span><span class="o">(</span><span class="s">"a request to the address collection resource"</span><span class="o">)</span>
            <span class="o">.</span><span class="na">path</span><span class="o">(</span><span class="s">"/addresses/"</span><span class="o">)</span>
            <span class="o">.</span><span class="na">method</span><span class="o">(</span><span class="s">"GET"</span><span class="o">)</span>
            <span class="o">.</span><span class="na">willRespondWith</span><span class="o">()</span>
            <span class="o">.</span><span class="na">status</span><span class="o">(</span><span class="mi">200</span><span class="o">)</span>
            <span class="o">.</span><span class="na">body</span><span class="o">(</span><span class="s">"..."</span><span class="o">,</span> <span class="s">"application/hal+json"</span><span class="o">)</span>
            <span class="o">.</span><span class="na">toPact</span><span class="o">();</span>
  <span class="o">}</span>

  <span class="nd">@Test</span>
  <span class="nd">@PactVerification</span><span class="o">(</span><span class="n">fragment</span> <span class="o">=</span> <span class="s">"createAddressCollectionResourcePact"</span><span class="o">)</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">verifyAddressCollectionPact</span><span class="o">()</span> <span class="o">{</span>
    <span class="n">Resources</span><span class="o">&lt;</span><span class="n">Address</span><span class="o">&gt;</span> <span class="n">addresses</span> <span class="o">=</span> <span class="n">addressClient</span><span class="o">.</span><span class="na">getAddresses</span><span class="o">();</span>
    <span class="n">assertThat</span><span class="o">(</span><span class="n">addresses</span><span class="o">).</span><span class="na">hasSize</span><span class="o">(</span><span class="mi">2</span><span class="o">);</span>
  <span class="o">}</span>

<span class="o">}</span>
</code></pre></div></div>

<p>We add the <code class="highlighter-rouge">@SpringBootTest</code> annotation to the test class so that a Spring Boot application context -
and thus our <code class="highlighter-rouge">AddressClient</code> - is created. You could create the <code class="highlighter-rouge">AddressClient</code> by hand instead of 
bootstrapping the whole Spring Boot application, but then you would not test the client that is created by Spring
Boot in production.</p>

<p>The <code class="highlighter-rouge">PactProviderRuleMk2</code> is included as a JUnit <code class="highlighter-rouge">@Rule</code>. This rule is responsible for evaluating the 
<code class="highlighter-rouge">@Pact</code> and <code class="highlighter-rouge">@PactVerification</code> annotations on the methods of the test class.</p>

<p>The method <code class="highlighter-rouge">createAddressCollectionResourcePact()</code> is annotated with <code class="highlighter-rouge">@Pact</code> and returns a <code class="highlighter-rouge">RequestResponsePact</code>.
This pact defines the structure and content of a request/response pair. When the unit test is executed, a JSON representation
of this pact is automatically generated into the file <code class="highlighter-rouge">target/pacts/addressClient-customerServiceProvider.json</code>.</p>

<p>Finally, the method <code class="highlighter-rouge">verifyAddressCollectionPact()</code> is annotated with <code class="highlighter-rouge">@PactVerification</code>, which tells Pact that
in this method we want to verify that our client works against the pact defined in the method 
<code class="highlighter-rouge">createAddressCollectionResourcePact()</code>. For this to work, Pact starts a stub HTTP server on port 8888 which
responds to the request defined in the pact with the response defined in the pact. When our <code class="highlighter-rouge">AddressClient</code>
successfully parses the response we know that it interacts according to the pact.</p>

<h2 id="publishing-a-pact">Publishing a Pact</h2>

<p>Now that we created a pact, it needs to be published so that the API provider can verify that it, too, 
interacts according to the pact.</p>

<p>In the simplest case, the pact file is created into a folder by the consumer and then read in from that 
same folder in a unit test on the provider side. That obviously only works when the code of both 
consumer and provider lies next to each other, which may not be desired due to several reasons.</p>

<p>Thus, we have to take measures to publish the pact file to some location the provider can access. This 
can be a network share, a simple web server or the more sophisticated <a href="https://github.com/pact-foundation/pact_broker">Pact Broker</a>.
Pact Broker is a repository server for pacts and provides an API that allows publication and
consumption of pact files.</p>

<p>I haven’t tried out any of those publication measures yet, so I can’t go into more detail. 
More information on different pact publication strategies can be found <a href="https://github.com/realestate-com-au/pact/wiki/Sharing-pacts-between-consumer-and-provider">here</a>.</p>

<h2 id="verifying-a-spring-data-rest-provider-against-a-pact">Verifying a Spring Data REST Provider against a Pact</h2>

<p>Assuming our consumer has created a pact, successfully verified against it and then published the pact, we now
have to verify that our provider also works according to the pact.</p>

<p>In our case, the provider is a Spring Data REST application that exposes a Spring Data repository via REST.
So, we need some kind of test that replays the request defined in the pact against the provider API and verify
that it returns the correct response. The following code implements such a test with JUnit:</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@RunWith</span><span class="o">(</span><span class="n">PactRunner</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
<span class="nd">@Provider</span><span class="o">(</span><span class="s">"customerServiceProvider"</span><span class="o">)</span>
<span class="nd">@PactFolder</span><span class="o">(</span><span class="s">"../pact-feign-consumer/target/pacts"</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">ProviderPactVerificationTest</span> <span class="o">{</span>

  <span class="nd">@ClassRule</span>
  <span class="kd">public</span> <span class="kd">static</span> <span class="n">SpringBootStarter</span> <span class="n">appStarter</span> <span class="o">=</span> <span class="n">SpringBootStarter</span><span class="o">.</span><span class="na">builder</span><span class="o">()</span>
          <span class="o">.</span><span class="na">withApplicationClass</span><span class="o">(</span><span class="n">DemoApplication</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
          <span class="o">.</span><span class="na">withArgument</span><span class="o">(</span><span class="s">"--spring.config.location=classpath:/application-pact.properties"</span><span class="o">)</span>
          <span class="o">.</span><span class="na">withDatabaseState</span><span class="o">(</span><span class="s">"address-collection"</span><span class="o">,</span> <span class="s">"/initial-schema.sql"</span><span class="o">,</span> <span class="s">"/address-collection.sql"</span><span class="o">)</span>
          <span class="o">.</span><span class="na">build</span><span class="o">();</span>

  <span class="nd">@State</span><span class="o">(</span><span class="s">"a collection of 2 addresses"</span><span class="o">)</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">toAddressCollectionState</span><span class="o">()</span> <span class="o">{</span>
    <span class="n">DatabaseStateHolder</span><span class="o">.</span><span class="na">setCurrentDatabaseState</span><span class="o">(</span><span class="s">"address-collection"</span><span class="o">);</span>
  <span class="o">}</span>

  <span class="nd">@TestTarget</span>
  <span class="kd">public</span> <span class="kd">final</span> <span class="n">Target</span> <span class="n">target</span> <span class="o">=</span> <span class="k">new</span> <span class="n">HttpTarget</span><span class="o">(</span><span class="mi">8080</span><span class="o">);</span>

<span class="o">}</span>
</code></pre></div></div>

<p><code class="highlighter-rouge">PactRunner</code> allows Pact to create the mock replay client. Also, we specify the
name of the API provider via <code class="highlighter-rouge">@Provider</code>. This is needed by Pact to find the correct pact file in the
<code class="highlighter-rouge">@PactFolder</code> we specified. In this case the pact files are located in the consumer code base which lies
next to the provider code base.</p>

<p>The method annotated with <code class="highlighter-rouge">@State</code> must be implemented to signal to the provider which state in the pact
is currently tested, so it can return the correct data. In our case, we switch the database backing
the provider in a state that contains the correct data.</p>

<p><code class="highlighter-rouge">@TestTarget</code> defines against which target the replay client should run. In our case against an HTTP
server on port 8080.</p>

<p>The classes <code class="highlighter-rouge">SpringBootRunner</code> and <code class="highlighter-rouge">DatabaseStateHolder</code> are classes I created myself that start up
the Spring Boot application with the provider API and allow to change the state of the underlying 
database by executing a set of SQL scripts. Note that if you’re implementing your own Spring 
MVC Controllers you can use the <a href="https://github.com/DiUS/pact-jvm/tree/master/pact-jvm-provider-spring">pact-jvm-provider-spring</a>
module instead of these custom classes. This module supports using MockMvc and thus you 
don’t need to bootstrap the whole Spring Boot application in the test. However, in our case Spring Data REST provides the MVC Controllers and there is no integration between Spring Data REST and Pact (yet?).</p>

<p>When the unit test is executed, Pact will now execute the requests defined in the pact files and
verify the responses against the pact. In the log output, you should see something like this:</p>

<div class="language-text highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Verifying a pact between addressClient and customerServiceProvider
  Given a collection of 2 addresses
  a request to the address collection resource
    returns a response which
      has status code 200 (OK)
      includes headers
        "Content-Type" with value "application/hal+json" (OK)
      has a matching body (OK)
</code></pre></div></div>

        
      </section>

      <footer class="page__meta">
        
        
  


  
  
  

  <p class="page__taxonomy">
    <strong><i class="fa fa-fw fa-tags" aria-hidden="true"></i> Tags: </strong>
    <span itemprop="keywords">
    
      
      
      <a href="https://reflectoring.io/tags/#boot" class="page__taxonomy-item" rel="tag">boot</a><span class="sep">, </span>
    
      
      
      <a href="https://reflectoring.io/tags/#consumer" class="page__taxonomy-item" rel="tag">consumer</a><span class="sep">, </span>
    
      
      
      <a href="https://reflectoring.io/tags/#contract" class="page__taxonomy-item" rel="tag">contract</a><span class="sep">, </span>
    
      
      
      <a href="https://reflectoring.io/tags/#data" class="page__taxonomy-item" rel="tag">data</a><span class="sep">, </span>
    
      
      
      <a href="https://reflectoring.io/tags/#driven" class="page__taxonomy-item" rel="tag">driven</a><span class="sep">, </span>
    
      
      
      <a href="https://reflectoring.io/tags/#feign" class="page__taxonomy-item" rel="tag">feign</a><span class="sep">, </span>
    
      
      
      <a href="https://reflectoring.io/tags/#pact" class="page__taxonomy-item" rel="tag">pact</a><span class="sep">, </span>
    
      
      
      <a href="https://reflectoring.io/tags/#rest" class="page__taxonomy-item" rel="tag">rest</a><span class="sep">, </span>
    
      
      
      <a href="https://reflectoring.io/tags/#spring" class="page__taxonomy-item" rel="tag">spring</a>
    
    </span>
  </p>




  


  
  
  

  <p class="page__taxonomy">
    <strong><i class="fa fa-fw fa-folder-open" aria-hidden="true"></i> Categories: </strong>
    <span itemprop="keywords">
    
      
      
      <a href="https://reflectoring.io/categories/#hacks" class="page__taxonomy-item" rel="tag">hacks</a>
    
    </span>
  </p>


        
          <p class="page__date"><strong><i class="fa fa-fw fa-calendar" aria-hidden="true"></i> Updated:</strong> <time datetime="2017-08-09T00:00:00+00:00">August 09, 2017</time></p>
        
      </footer>

      <section class="page__share">
  
    <h4 class="page__share-title">Share on</h4>
  

  <a href="https://twitter.com/intent/tweet?text=Consumer-Driven%20Contracts%20with%20Pact,%20Feign%20and%20Spring%20Data%20REST%20https://reflectoring.io/consumer-driven-contracts-with-pact-feign-spring-data-rest/" class="btn btn--twitter" title="Share on Twitter"><i class="fa fa-fw fa-twitter" aria-hidden="true"></i><span> Twitter</span></a>

  <a href="https://www.facebook.com/sharer/sharer.php?u=https://reflectoring.io/consumer-driven-contracts-with-pact-feign-spring-data-rest/" class="btn btn--facebook" title="Share on Facebook"><i class="fa fa-fw fa-facebook" aria-hidden="true"></i><span> Facebook</span></a>

  <a href="https://plus.google.com/share?url=https://reflectoring.io/consumer-driven-contracts-with-pact-feign-spring-data-rest/" class="btn btn--google-plus" title="Share on Google Plus"><i class="fa fa-fw fa-google-plus" aria-hidden="true"></i><span> Google+</span></a>

  <a href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https://reflectoring.io/consumer-driven-contracts-with-pact-feign-spring-data-rest/" class="btn btn--linkedin" title="Share on LinkedIn"><i class="fa fa-fw fa-linkedin" aria-hidden="true"></i><span> LinkedIn</span></a>
</section>


      
  <nav class="pagination">
    
      <a href="https://reflectoring.io/documenting-spring-data-rest-api-with-springfox/" class="pagination--pager" title="Documenting a Spring Data REST API with Springfox and Swagger
">Previous</a>
    
    
      <a href="https://reflectoring.io/howto-format-code-snippets-in-javadoc/" class="pagination--pager" title="A Guide to Formatting Code Snippets in Javadoc
">Next</a>
    
  </nav>

    </div>

    
      <div class="page__comments">
  
    
        <h4 class="page__comments-title">Leave a Comment</h4>
        <section id="disqus_thread"><iframe id="dsq-app5201" name="dsq-app5201" allowtransparency="true" frameborder="0" scrolling="no" tabindex="0" title="Disqus" sandbox="allow-forms allow-popups allow-same-origin allow-scripts" width="100%" src="./Consumer-Driven Contracts with Pact, Feign and Spring Data REST - Reflectoring_files/saved_resource.html" style="width: 1px !important; min-width: 100% !important; border: none !important; overflow: hidden !important; height: 0px !important; display: none !important;"></iframe><iframe id="dsq-app5198" name="dsq-app5198" allowtransparency="true" frameborder="0" scrolling="no" tabindex="0" title="Disqus" width="100%" src="./Consumer-Driven Contracts with Pact, Feign and Spring Data REST - Reflectoring_files/saved_resource(1).html" style="width: 1px !important; min-width: 100% !important; border: none !important; overflow: hidden !important; height: 908px !important;" horizontalscrolling="no" verticalscrolling="no"></iframe></section>
      
</div>
    
  </article>

  
  
    <div class="page__related">
      <h4 class="page__related-title">You May Also Enjoy</h4>
      <div class="grid__wrapper">
        
          



<div class="grid__item">
  <article class="archive__item" itemscope="" itemtype="http://schema.org/CreativeWork">
    
    <h2 class="archive__item-title" itemprop="headline">
      
        <a href="https://reflectoring.io/skip-ci-build/" rel="permalink">Skipping a CI Build for non-code changes
</a>
      
    </h2>
    
      <p class="page__meta"><i class="fa fa-clock-o" aria-hidden="true"></i> 




  2 minute read
</p>
    
    <p class="archive__item-excerpt" itemprop="description">Skipping a CI build is like purposefully not brushing your teeth every morning and evening.
You know it should not be skipped and you feel guilty when you do...</p>
  </article>
</div>

        
          



<div class="grid__item">
  <article class="archive__item" itemscope="" itemtype="http://schema.org/CreativeWork">
    
      <div class="archive__item-teaser">
        <img src="./Consumer-Driven Contracts with Pact, Feign and Spring Data REST - Reflectoring_files/cube.jpg" alt="">
      </div>
    
    <h2 class="archive__item-title" itemprop="headline">
      
        <a href="https://reflectoring.io/testing-verticals-and-layers-spring-boot/" rel="permalink">Structuring and Testing Modules and Layers with Spring Boot
</a>
      
    </h2>
    
      <p class="page__meta"><i class="fa fa-clock-o" aria-hidden="true"></i> 




  8 minute read
</p>
    
    <p class="archive__item-excerpt" itemprop="description">Well-behaved software consists of highly cohesive modules that are loosely coupled
to other modules. Each module takes care from user input on the web layer ...</p>
  </article>
</div>

        
          



<div class="grid__item">
  <article class="archive__item" itemscope="" itemtype="http://schema.org/CreativeWork">
    
      <div class="archive__item-teaser">
        <img src="./Consumer-Driven Contracts with Pact, Feign and Spring Data REST - Reflectoring_files/communication.jpg" alt="">
      </div>
    
    <h2 class="archive__item-title" itemprop="headline">
      
        <a href="https://reflectoring.io/microservice-communication-patterns/" rel="permalink">Microservice Communication Patterns
</a>
      
    </h2>
    
      <p class="page__meta"><i class="fa fa-clock-o" aria-hidden="true"></i> 




  6 minute read
</p>
    
    <p class="archive__item-excerpt" itemprop="description">A microservice architecture is all about communication. How should services communicate in any
given business scenario? Should they call each other synchrono...</p>
  </article>
</div>

        
          



<div class="grid__item">
  <article class="archive__item" itemscope="" itemtype="http://schema.org/CreativeWork">
    
      <div class="archive__item-teaser">
        <img src="./Consumer-Driven Contracts with Pact, Feign and Spring Data REST - Reflectoring_files/contract.jpg" alt="">
      </div>
    
    <h2 class="archive__item-title" itemprop="headline">
      
        <a href="https://reflectoring.io/consumer-driven-contract-feign-pact/" rel="permalink">Creating a Consumer-Driven Contract with Feign and Pact
</a>
      
    </h2>
    
      <p class="page__meta"><i class="fa fa-clock-o" aria-hidden="true"></i> 




  5 minute read
</p>
    
    <p class="archive__item-excerpt" itemprop="description">Consumer-driven contract tests are a technique to test integration
points between API providers and API consumers without the hassle of end-to-end tests (rea...</p>
  </article>
</div>

        
      </div>
    </div>
  
</div>


    <div class="page__footer">
      <footer>
        <!-- start custom footer snippets -->

<!-- end custom footer snippets -->
        <div class="page__footer-follow">
  <ul class="social-icons">
    
      <li><strong>Follow:</strong></li>
    
    
    
    
      <li><a href="http://github.com/reflectoring/reflectoring.github.io"><i class="fa fa-fw fa-github" aria-hidden="true"></i> GitHub</a></li>
    
    
    
    <li><a href="https://reflectoring.io/feed.xml"><i class="fa fa-fw fa-rss-square" aria-hidden="true"></i> Feed</a></li>
  </ul>
</div>

<div class="page__footer-copyright">© 2018 Reflectoring. Powered by <a href="http://jekyllrb.com/" rel="nofollow">Jekyll</a> &amp; <a href="https://mademistakes.com/work/minimal-mistakes-jekyll-theme/" rel="nofollow">Minimal Mistakes</a>.</div>

      </footer>
    </div>

    <script src="./Consumer-Driven Contracts with Pact, Feign and Spring Data REST - Reflectoring_files/main.min.js.download"></script>




  <script type="text/javascript">
  if (document.location.hostname == "reflectoring.io") {
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-88407702-1']);
    _gaq.push(['_trackPageview']);

    (function () {
      var ga = document.createElement('script');
      ga.type = 'text/javascript';
      ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0];
      s.parentNode.insertBefore(ga, s);
    })();
  }
</script>






  
      
  <script type="text/javascript">
  	/* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
  	var disqus_shortname = 'reflectoring';

  	/* * * DON'T EDIT BELOW THIS LINE * * */
  	(function() {
  		var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
  		dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
  		(document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  	})();

  	/* * * DON'T EDIT BELOW THIS LINE * * */
  	(function () {
  		var s = document.createElement('script'); s.async = true;
  		s.type = 'text/javascript';
  		s.src = '//' + disqus_shortname + '.disqus.com/count.js';
  		(document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
  	}());
  </script>
  <noscript>Please enable JavaScript to view the <a href="<a class="vglnk" href="http://disqus.com/?ref_noscript" rel="nofollow"><span>http</span><span>://</span><span>disqus</span><span>.</span><span>com</span><span>/?</span><span>ref</span><span>_</span><span>noscript</span></a>">comments powered by Disqus.</a></noscript>

    



  

<iframe style="display: none;" src="./Consumer-Driven Contracts with Pact, Feign and Spring Data REST - Reflectoring_files/saved_resource(2).html"></iframe></body></html>